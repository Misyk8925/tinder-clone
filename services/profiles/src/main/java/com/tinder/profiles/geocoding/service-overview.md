–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ Nominatim API (OpenStreetMap –≥–µ–æ–∫–æ–¥–µ—Ä), —á—Ç–æ–±—ã –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –≥–æ—Ä–æ–¥–∞ –≤–µ—Ä–Ω—É—Ç—å –µ–≥–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–¥–æ–ª–≥–æ—Ç–∞/—à–∏—Ä–æ—Ç–∞). –†–∞–∑–±–µ—Ä—ë–º –ø–æ—Å—Ç—Ä–æ—á–Ω–æ üëá

‚∏ª

–°–∏–≥–Ω–∞—Ç—É—Ä–∞

public Optional<GeoPoint> geocodeCity(String city)

	‚Ä¢	–ù–∞ –≤—Ö–æ–¥: —Å—Ç—Ä–æ–∫–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –≥–æ—Ä–æ–¥–∞.
	‚Ä¢	–ù–∞ –≤—ã—Ö–æ–¥: Optional<GeoPoint> (–≤–Ω—É—Ç—Ä–∏ –µ—Å—Ç—å lon/lat, –µ—Å–ª–∏ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏; –∏–ª–∏ Optional.empty(), –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å).

‚∏ª

–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
1.	–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–∞

if (city == null || city.isBlank()) return Optional.empty();

–ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –ø—É—Å—Ç–∞—è ‚Üí —Å—Ä–∞–∑—É –≤–µ—Ä–Ω—ë–º –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

	2.	HTTP GET –∑–∞–ø—Ä–æ—Å –∫ Nominatim

nominatimClient.get()
.uri(uri -> uri.path("/search")
.queryParam("q", city.trim())
.queryParam("format", "jsonv2")
.queryParam("limit", 1)
.queryParam("addressdetails", 1)
.queryParamIfPresent("countrycodes", ...)
.build())

	‚Ä¢	q=city ‚Üí –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞.
	‚Ä¢	format=jsonv2 ‚Üí –≤–µ—Ä–Ω—É—Ç—å JSON.
	‚Ä¢	limit=1 ‚Üí —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
	‚Ä¢	addressdetails=1 ‚Üí –≤–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∞–¥—Ä–µ—Å–∞.
	‚Ä¢	countrycodes (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω) ‚Üí –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–æ–∏—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Å—Ç—Ä–∞–Ω–∞–º–∏.

3.	–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞

.accept(MediaType.APPLICATION_JSON)
.retrieve()
.onStatus(status -> status.isError(), response -> response.createException())
.bodyToMono(NominatimResult[].class)

	‚Ä¢	–ñ–¥—ë–º JSON-–º–∞—Å—Å–∏–≤ NominatimResult[].
	‚Ä¢	–ï—Å–ª–∏ HTTP-–æ—à–∏–±–∫–∞ ‚Üí –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.

4.	–¢–∞–π–º–∞—É—Ç –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

.timeout(Duration.ofMillis(timeoutMs))
.onErrorResume(ex -> Mono.just(new NominatimResult[0]))

	‚Ä¢	–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –≤–∏—Å–∏—Ç –¥–æ–ª—å—à–µ timeoutMs ‚Üí –ø—Ä–µ—Ä—ã–≤–∞–µ–º.
	‚Ä¢	–ï—Å–ª–∏ –ª—é–±–∞—è –æ—à–∏–±–∫–∞ (—Å–µ—Ç—å, –ø–∞—Ä—Å–∏–Ω–≥ –∏ —Ç.–¥.) ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤.

5.	–ë–µ—Ä—ë–º –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ GeoPoint

.map(arr -> arr.length > 0
    ? Optional.of(arr[0].toPoint())
    : Optional.<GeoPoint>empty())

	‚Ä¢	–ï—Å–ª–∏ –º–∞—Å—Å–∏–≤ –Ω–µ –ø—É—Å—Ç–æ–π ‚Üí –±–µ—Ä—ë–º arr[0], –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ GeoPoint(lon, lat).
	‚Ä¢	–ò–Ω–∞—á–µ ‚Üí Optional.empty().

6.	–ï—Å–ª–∏ –≤–æ–æ–±—â–µ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç

.defaultIfEmpty(Optional.<GeoPoint>empty())

‚Üí fallback –Ω–∞ –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

	7.	–ë–ª–æ–∫–∏—Ä—É–µ–º —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ—Ç–æ–∫

.block();

–í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–π Optional<GeoPoint> –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –≤–∏–¥–µ.

‚∏ª

–ò—Ç–æ–≥
‚Ä¢	–ï—Å–ª–∏ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –≥–æ—Ä–æ–¥ ‚Üí Optional.of(new GeoPoint(lon, lat)).
‚Ä¢	–ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –∏–ª–∏ –æ—à–∏–±–∫–∞ ‚Üí Optional.empty().

‚∏ª

–•–æ—á–µ—à—å, —è –ø–æ–∫–∞–∂—É, –∫–∞–∫ —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∫–æ—Ä–æ—á–µ –∏ —á–∏—â–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ Arrays.stream(arr).findFirst()), —á—Ç–æ–±—ã –Ω–µ —Ç–∞—Å–∫–∞—Ç—å –ª–∏—à–Ω–∏–µ Optional.empty() –≤ —Ü–µ–ø–æ—á–∫–µ?