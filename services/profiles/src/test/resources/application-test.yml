spring:
  main:
    allow-bean-definition-overriding: true
  cloud:
    config:
      enabled: false
      import-check:
        enabled: false
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: http://localhost:9080/realms/spring/protocol/openid-connect/certs
  jpa:
    hibernate:
      ddl-auto: create-drop
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
  data:
    redis:
      host: localhost
      port: 6379
  cache:
    type: redis
  servlet:
    multipart:
      max-file-size: 50MB
      max-request-size: 60MB
  application:
    name: profiles-service
  kafka:
    bootstrap-servers: localhost:9092
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      acks: all
      retries: 3
      properties:
        max.in.flight.requests.per.connection: 5
        enable.idempotence: true
        spring.json.add.type.headers: false
    consumer:
      group-id: profiles-test-group
      auto-offset-reset: earliest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "com.tinder.*"

server:
  port: 8011
  servlet:
    context-path: /api/v1/profiles

app:
  s3:
    bucket: "test-bucket"
    presign-exp-seconds: 300
  geocoding:
    user-agent: "TinderClone/1.0 (tclone@tclone.com)"
    base-url: "https://nominatim.openstreetmap.org"
    country-codes: "de,at,pl"
    timeout-ms: 3000

cloud:
  aws:
    region: eu-north-1



keycloak:
  auth-server-url: http://localhost:6700
  realm: spring
  client-id: profiles-service

# Kafka topics
kafka:
  topics:
    profile-events:
      updated: profile.updated
      created: profile.created
      deleted: profile.deleted

# Resilience4j configuration for tests
resilience4j:
  circuitbreaker:
    configs:
      default:
        slidingWindowType: COUNT_BASED
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        failureRateThreshold: 50
        slowCallRateThreshold: 50
        slowCallDurationThreshold: 1s
        waitDurationInOpenState: 5s
        permittedNumberOfCallsInHalfOpenState: 3
        automaticTransitionFromOpenToHalfOpenEnabled: true
        recordExceptions:
          - java.lang.Exception
        ignoreExceptions:
          - java.lang.IllegalArgumentException
    instances:
      nominatimClient:
        baseConfig: default
        slowCallDurationThreshold: 500ms
        failureRateThreshold: 60
      redisCache:
        baseConfig: default
        slidingWindowSize: 20
        minimumNumberOfCalls: 5
        failureRateThreshold: 50
        slowCallDurationThreshold: 1000ms
        waitDurationInOpenState: 20s
      kafkaProducer:
        baseConfig: default
        slidingWindowSize: 50
        minimumNumberOfCalls: 10
        failureRateThreshold: 60
        slowCallDurationThreshold: 3000ms
        waitDurationInOpenState: 60s
        permittedNumberOfCallsInHalfOpenState: 10
  bulkhead:
    instances:
      nominatimClient:
        maxConcurrentCalls: 20
        maxWaitDuration: 0
      redisCache:
        maxConcurrentCalls: 50
        maxWaitDuration: 100ms
      kafkaProducer:
        maxConcurrentCalls: 100
        maxWaitDuration: 500ms
  retry:
    instances:
      nominatimClient:
        maxAttempts: 2
        waitDuration: 100ms
        enableExponentialBackoff: true
        exponentialBackoffMultiplier: 2
      redisCache:
        maxAttempts: 2
        waitDuration: 100ms
      kafkaProducer:
        maxAttempts: 2
        waitDuration: 500ms
        enableExponentialBackoff: true
        exponentialBackoffMultiplier: 2


